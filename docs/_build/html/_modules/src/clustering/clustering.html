


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>src.clustering.clustering &mdash; Adaptive Sampling  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Adaptive Sampling  documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Adaptive Sampling
          

          
          </a>

          
            
            
              <div class="version">
                v0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AdaptiveSampling.html">AdaptiveSampling Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Examples.html">Blalbalbke</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Adaptive Sampling</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          









<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>src.clustering.clustering</li>
    <li class="wy-breadcrumbs-aside">
      
          
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for src.clustering.clustering</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">clusteringTypes</span>
<span class="kn">import</span> <span class="nn">thresholdcalculator</span>
<span class="kn">from</span> <span class="nn">constants</span> <span class="kn">import</span> <span class="n">blockNames</span>
<span class="kn">from</span> <span class="nn">atomset</span> <span class="kn">import</span> <span class="n">atomset</span>
<span class="kn">from</span> <span class="nn">utilities</span> <span class="kn">import</span> <span class="n">utilities</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">AffinityPropagation</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">AgglomerativeClustering</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>


<div class="viewcode-block" id="Clusters"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Clusters">[docs]</a><span class="k">class</span> <span class="nc">Clusters</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Clusters.addCluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Clusters.addCluster">[docs]</a>    <span class="k">def</span> <span class="nf">addCluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Clusters.printClusters"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Clusters.printClusters">[docs]</a>    <span class="k">def</span> <span class="nf">printClusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;--------------&quot;</span>
            <span class="k">print</span> <span class="s">&quot;CLUSTER #</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">i</span>
            <span class="k">print</span> <span class="s">&quot;--------------&quot;</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">printCluster</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;&quot;</span>
</div>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">clusters</span>

</div>
<div class="viewcode-block" id="Cluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Cluster">[docs]</a><span class="k">class</span> <span class="nc">Cluster</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A cluster contains a representative structure(pdb), the number of</span>
<span class="sd">        elements, its density, threhold, number of contacts,</span>
<span class="sd">        a contactMap(sometimes) and a metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdb</span><span class="p">,</span> <span class="n">thresholdRadius</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">contactMap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">contacts</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">metrics</span><span class="o">=</span><span class="p">[],</span> <span class="n">metricCol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            contacts stands for contacts/ligandAtom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span> <span class="o">=</span> <span class="n">pdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">thresholdRadius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="n">density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">=</span> <span class="n">contacts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contactMap</span> <span class="o">=</span> <span class="n">contactMap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metricCol</span> <span class="o">=</span> <span class="n">metricCol</span>

<div class="viewcode-block" id="Cluster.getMetric"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Cluster.getMetric">[docs]</a>    <span class="k">def</span> <span class="nf">getMetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metricCol</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Cluster.addElement"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Cluster.addElement">[docs]</a>    <span class="k">def</span> <span class="nf">addElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span> <span class="ow">and</span> <span class="n">metrics</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metricCol</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metricCol</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span>
</div>
<div class="viewcode-block" id="Cluster.printCluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Cluster.printCluster">[docs]</a>    <span class="k">def</span> <span class="nf">printCluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">printAtoms</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Elements: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>
        <span class="k">print</span> <span class="s">&quot;Metrics: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Radius threshold: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
        <span class="k">print</span> <span class="s">&quot;Number of contacts: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span>
</div>
<div class="viewcode-block" id="Cluster.writePDB"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Cluster.writePDB">[docs]</a>    <span class="k">def</span> <span class="nf">writePDB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Cluster.getContacts"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Cluster.getContacts">[docs]</a>    <span class="k">def</span> <span class="nf">getContacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span>
</div>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">pdb</span>\
             <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">elements</span>\
             <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">threshold</span>\
             <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">contacts</span>\
             <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Clustering"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Clustering">[docs]</a><span class="k">class</span> <span class="nc">Clustering</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Base class for clustering methods, it defines a cluster method that</span>
<span class="sd">        contacts and accumulative inherit and use</span>

<span class="sd">        resname [In] String containing the three letter name of the ligan in the pdb</span>
<span class="sd">        reportBaseFilename [In] Name of the file that contains the metrics of the snapshots to cluster</span>
<span class="sd">        columnOfReportFile [In] Column of the report file that contain the metric of interest</span>
<span class="sd">        contactThresholdDistance [In] Distance at wich a ligand atom and a protein atom are</span>
<span class="sd">        considered in contact(default 8)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">columnOfReportFile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">contactThresholdDistance</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;BaseClass&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="n">Clusters</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">reportBaseFilename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reportBaseFilename</span> <span class="o">=</span> <span class="n">reportBaseFilename</span> <span class="o">+</span> <span class="s">&quot;_</span><span class="si">%d</span><span class="s">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reportBaseFilename</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resname</span> <span class="o">=</span> <span class="n">resname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">columnOfReportFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contactThresholdDistance</span> <span class="o">=</span> <span class="n">contactThresholdDistance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetries</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Clustering.setCol"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Clustering.setCol">[docs]</a>    <span class="k">def</span> <span class="nf">setCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">col</span>

        <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">metricCol</span> <span class="o">=</span> <span class="n">col</span>
</div>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">clusters</span>\
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportBaseFilename</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">reportBaseFilename</span>\
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resname</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">resname</span>\
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">col</span>

    <span class="c"># Moved the cluster methods of contactsClustering to the Clustering</span>
    <span class="c"># superclass in order to make accessible to contactMapAccumaltiveClustering</span>
    <span class="c"># and avoid duplicate code</span>
<div class="viewcode-block" id="Clustering.cluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Clustering.cluster">[docs]</a>    <span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Cluster the snaptshots contained in the pahts folder</span>
<span class="sd">            paths [In] List of folders with the snapshots</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trajectories</span> <span class="o">=</span> <span class="n">getAllTrajectories</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trajectory</span> <span class="ow">in</span> <span class="n">trajectories</span><span class="p">:</span>
            <span class="n">trajNum</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">getTrajNum</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>

            <span class="n">snapshots</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">getSnapshots</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportBaseFilename</span><span class="p">:</span>
                <span class="n">reportFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">reportBaseFilename</span> <span class="o">%</span> <span class="n">trajNum</span><span class="p">)</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">reportFilename</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snapshots</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addSnapshotToCluster</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="n">num</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snapshots</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addSnapshotToCluster</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Clustering.writeOutput"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.Clustering.writeOutput">[docs]</a>    <span class="k">def</span> <span class="nf">writeOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">degeneracy</span><span class="p">,</span> <span class="n">outputObject</span><span class="p">,</span> <span class="n">writeAll</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Writes all the clustering information in outputPath</span>

<span class="sd">            outputPath [In] Folder that will contain all the clustering information</span>
<span class="sd">            degeneracy [In] Degeneracy of each cluster. It must be in the same order</span>
<span class="sd">            as in the self.clusters list</span>
<span class="sd">            outputObject [In] Output name for the pickle object</span>
<span class="sd">            writeAll [In] Boolean, wether to write pdb files for all cluster in addition</span>
<span class="sd">            of the summary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">utilities</span><span class="o">.</span><span class="n">cleanup</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>
        <span class="n">utilities</span><span class="o">.</span><span class="n">makeFolder</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>

        <span class="n">summaryFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="s">&quot;summary.txt&quot;</span><span class="p">)</span>
        <span class="n">summaryFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">summaryFilename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">summaryFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;#cluster size degeneracy contacts threshold density metric</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">writeAll</span><span class="p">:</span>
                <span class="n">outputFilename</span> <span class="o">=</span> <span class="s">&quot;cluster_</span><span class="si">%d</span><span class="s">.pdb&quot;</span> <span class="o">%</span> <span class="n">i</span>
                <span class="n">outputFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">)</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">)</span>

            <span class="n">metric</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">getMetric</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">metric</span><span class="p">:</span>
                <span class="n">writeString</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%.2f</span><span class="s"> </span><span class="si">%.2f</span><span class="s"> </span><span class="si">%.1f</span><span class="s"> </span><span class="si">%.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
                                                                <span class="n">degeneracy</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                <span class="n">cluster</span><span class="o">.</span><span class="n">contacts</span><span class="p">,</span>
                                                                <span class="n">cluster</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span>
                                                                <span class="n">cluster</span><span class="o">.</span><span class="n">density</span><span class="p">,</span>
                                                                <span class="n">metric</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">writeString</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%.2f</span><span class="s"> </span><span class="si">%.2f</span><span class="s"> </span><span class="si">%.1f</span><span class="s"> -</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
                                                             <span class="n">degeneracy</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                             <span class="n">cluster</span><span class="o">.</span><span class="n">contacts</span><span class="p">,</span>
                                                             <span class="n">cluster</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span>
                                                             <span class="n">cluster</span><span class="o">.</span><span class="n">density</span><span class="p">)</span>
            <span class="n">summaryFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writeString</span><span class="p">)</span>
        <span class="n">summaryFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputObject</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ContactsClustering"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactsClustering">[docs]</a><span class="k">class</span> <span class="nc">ContactsClustering</span><span class="p">(</span><span class="n">Clustering</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cluster together all snapshots that are closer to the cluster center</span>
<span class="sd">        than certain threshold. This threshold is assigned according to the</span>
<span class="sd">        ratio of number of contacts over the number of heavy atoms of the ligand</span>

<span class="sd">        thresholdCalculator [In] ThresholdCalculator object that calculate the</span>
<span class="sd">        threshold according to the contacts ratio</span>
<span class="sd">        resname [In] String containing the three letter name of the ligand</span>
<span class="sd">        in the pdb</span>
<span class="sd">        reportBaseFilename [In] Name of the file that contains the metrics of</span>
<span class="sd">        the snapshots to cluster</span>
<span class="sd">        columnOfReportFile [In] Column of the report file that contain the</span>
<span class="sd">        metric of interest</span>
<span class="sd">        contactThresholdDistance [In] Distance at wich a ligand atom and a protein atom are</span>
<span class="sd">        considered in contact(default 8)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresholdCalculator</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">reportBaseFilename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columnOfReportFile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">contactThresholdDistance</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">symmetries</span><span class="o">=</span><span class="p">{}):</span>
        <span class="n">Clustering</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="p">,</span>
                            <span class="n">columnOfReportFile</span><span class="p">,</span> <span class="n">contactThresholdDistance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">clusteringTypes</span><span class="o">.</span><span class="n">CLUSTERING_TYPES</span><span class="o">.</span><span class="n">contacts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholdCalculator</span> <span class="o">=</span> <span class="n">thresholdCalculator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetries</span> <span class="o">=</span> <span class="n">symmetries</span>


<div class="viewcode-block" id="ContactsClustering.addSnapshotToCluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactsClustering.addSnapshotToCluster">[docs]</a>    <span class="k">def</span> <span class="nf">addSnapshotToCluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snapshot</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[],</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">pdb</span> <span class="o">=</span> <span class="n">atomset</span><span class="o">.</span><span class="n">PDB</span><span class="p">()</span>
        <span class="n">pdb</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">clusterNum</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">atomset</span><span class="o">.</span><span class="n">computeRMSD</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">pdb</span><span class="p">,</span> <span class="n">pdb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetries</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cluster</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">addElement</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c"># if made it here, the snapshot was not added into any cluster</span>
        <span class="n">contacts</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">countContacts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contactThresholdDistance</span><span class="p">)</span>
        <span class="n">numberOfLigandAtoms</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">()</span>
        <span class="n">contactsPerAtom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">contacts</span><span class="p">)</span><span class="o">/</span><span class="n">numberOfLigandAtoms</span>

        <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholdCalculator</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">contactsPerAtom</span><span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">pdb</span><span class="p">,</span> <span class="n">thresholdRadius</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">contacts</span><span class="o">=</span><span class="n">contactsPerAtom</span><span class="p">,</span>
                          <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="n">metricCol</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">addCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ContactMapClustering"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactMapClustering">[docs]</a><span class="k">class</span> <span class="nc">ContactMapClustering</span><span class="p">(</span><span class="n">Clustering</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">columnOfReportFile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">contactThresholdDistance</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">Clustering</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="p">,</span>
                            <span class="n">columnOfReportFile</span><span class="p">,</span> <span class="n">contactThresholdDistance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">clusteringTypes</span><span class="o">.</span><span class="n">CLUSTERING_TYPES</span><span class="o">.</span><span class="n">contactMapAffinity</span>

<div class="viewcode-block" id="ContactMapClustering.cluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactMapClustering.cluster">[docs]</a>    <span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cluster the snapshots of the trajectories provided using the</span>
<span class="sd">        affinity propagation algorithm and the contactMaps similarity.</span>

<span class="sd">        A double clustering process is going on. First, all snapshots from an</span>
<span class="sd">        epoch are clustered together, and then these clusters are clustered</span>
<span class="sd">        together with the previous clusters, if any</span>

<span class="sd">        Paths [in] list with the path to the trajectories to cluster&quot;&quot;&quot;</span>
        <span class="n">trajectories</span> <span class="o">=</span> <span class="n">getAllTrajectories</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

        <span class="n">pdb_list</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">contactmaps</span><span class="p">,</span> <span class="n">contacts</span> <span class="o">=</span> <span class="n">processSnapshots</span><span class="p">(</span><span class="n">trajectories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportBaseFilename</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contactThresholdDistance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resname</span><span class="p">)</span>
        <span class="n">preferences</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span><span class="n">contactmaps</span><span class="p">)</span>

        <span class="n">preferences</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">preferences</span><span class="p">)</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="n">preferences</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">preferences</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span> <span class="o">=</span> <span class="n">clusteringResultsParameters</span><span class="p">(</span><span class="n">pdb_list</span><span class="o">=</span><span class="n">pdb_list</span><span class="p">,</span>
                                                            <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
                                                            <span class="n">contactmaps</span><span class="o">=</span><span class="n">contactmaps</span><span class="p">,</span><span class="n">contacts</span><span class="o">=</span><span class="n">contacts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span> <span class="o">=</span> <span class="n">clusteringResultsParameters</span><span class="p">(</span><span class="n">contactmaps</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">contactmapsArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="p">)</span>
        <span class="n">cluster_center_indices</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">clusterContactMaps</span><span class="p">(</span><span class="n">contactmapsArray</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="n">preferences</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processClusterResults</span><span class="p">(</span><span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="n">cluster_center_indices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
        <span class="c"># print &quot;Number of clusters after first clustering&quot;, len(self.firstClusteringParams.newClusters.clusters)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">clusterNum</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;old:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">clusterNum</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>

            <span class="n">preferences</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">preferences</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="c"># preferences = -np.array(self.secondClusteringParams.elements)</span>
            <span class="c"># prefereneces = None</span>
            <span class="n">secondcontactmapsArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="p">)</span>
            <span class="n">cluster_center_indices</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">clusterContactMaps</span><span class="p">(</span><span class="n">secondcontactmapsArray</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="n">preferences</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processClusterResults</span><span class="p">(</span><span class="s">&quot;second&quot;</span><span class="p">,</span> <span class="n">cluster_center_indices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
            <span class="c"># print &quot;Number of clusters after second clustering&quot;, len(self.secondClusteringParams.newClusters.clusters)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">newClusters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">newClusters</span>
</div>
<div class="viewcode-block" id="ContactMapClustering.processClusterResults"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactMapClustering.processClusterResults">[docs]</a>    <span class="k">def</span> <span class="nf">processClusterResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">cluster_center_indices</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Analyse the results obtained from the affinity propagation</span>
<span class="sd">        algorithm.</span>

<span class="sd">        Process [In] String to decide wether it is the results of the first or</span>
<span class="sd">        second clustering</span>
<span class="sd">        cluster_center_indices [In] Numpy array with the snapshots taht are</span>
<span class="sd">        cluster centers</span>
<span class="sd">        Indices [In] Numpy array with the cluster each snapshot belongs to&quot;&quot;&quot;</span>
        <span class="n">center_ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">cluster_center_indices</span><span class="p">:</span>

            <span class="n">cluster_members</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">indices</span> <span class="o">==</span> <span class="n">center_ind</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">process</span> <span class="o">==</span> <span class="s">&quot;first&quot;</span><span class="p">:</span>
                <span class="n">elements_in_cluster</span> <span class="o">=</span> <span class="n">cluster_members</span><span class="o">.</span><span class="n">size</span>
                <span class="n">metricsArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="n">best_metric_ind</span> <span class="o">=</span> <span class="n">cluster_members</span><span class="p">[</span><span class="n">metricsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">best_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">best_metric_ind</span><span class="p">]</span>

                <span class="n">cluster_index</span> <span class="o">=</span> <span class="n">selectRandomCenter</span><span class="p">(</span><span class="n">cluster_members</span><span class="p">,</span>
                                                   <span class="n">metricsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">])</span>

                <span class="n">contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">]</span>
                <span class="n">numberOfLigandAtoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">pdb_list</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">()</span>
                <span class="n">contactsPerAtom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">contacts</span><span class="p">)</span><span class="o">/</span><span class="n">numberOfLigandAtoms</span>

                <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">pdb_list</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">],</span>
                                  <span class="n">contactMap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">],</span>
                                  <span class="n">contacts</span><span class="o">=</span><span class="n">contactsPerAtom</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">best_metrics</span><span class="p">,</span> <span class="n">metricCol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

                <span class="n">cluster</span><span class="o">.</span><span class="n">elements</span> <span class="o">+=</span> <span class="n">elements_in_cluster</span><span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;new:</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">center_ind</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">newClusters</span><span class="o">.</span><span class="n">addCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elementsArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                <span class="n">metricsArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="n">elements_in_cluster</span> <span class="o">=</span> <span class="n">elementsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">selectRandomCenter</span><span class="p">(</span><span class="n">cluster_members</span><span class="p">,</span>
                                           <span class="n">metricsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">])</span>
                <span class="n">cluster_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">best_metric_ind</span> <span class="o">=</span> <span class="n">cluster_members</span><span class="p">[</span><span class="n">metricsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">best_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">best_metric_ind</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">newClusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">):</span>
                    <span class="n">cluster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">newClusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">]</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">best_metrics</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">elements</span> <span class="o">+=</span> <span class="p">(</span><span class="n">elements_in_cluster</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">newClusters</span><span class="o">.</span><span class="n">addCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

            <span class="n">center_ind</span> <span class="o">+=</span> <span class="mi">1</span>

</div></div>
<div class="viewcode-block" id="ContactMapAgglomerativeClustering"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactMapAgglomerativeClustering">[docs]</a><span class="k">class</span> <span class="nc">ContactMapAgglomerativeClustering</span><span class="p">(</span><span class="n">Clustering</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;nclusters[In] Number of the cluster to generate with the hierarchical clustering algorithm</span>
<span class="sd">        resname [In] String containing the three letter name of the ligan in the pdb</span>
<span class="sd">        reportBaseFilename [In] Name of the file that contains the metrics of the snapshots to cluster</span>
<span class="sd">        columnOfReportFile [In] Column of the report file that contain the metric of interest</span>
<span class="sd">        contactThresholdDistance [In] Distance at wich a ligand atom and a protein atom are</span>
<span class="sd">        considered in contact(default 8)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nclusters</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">columnOfReportFile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">contactThresholdDistance</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">Clustering</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="p">,</span>
                            <span class="n">columnOfReportFile</span><span class="p">,</span> <span class="n">contactThresholdDistance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">clusteringTypes</span><span class="o">.</span><span class="n">CLUSTERING_TYPES</span><span class="o">.</span><span class="n">contactMapAgglomerative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nclusters</span> <span class="o">=</span> <span class="n">nclusters</span>

<div class="viewcode-block" id="ContactMapAgglomerativeClustering.cluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactMapAgglomerativeClustering.cluster">[docs]</a>    <span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clusters the snapshots of the trajectories provided using</span>
<span class="sd">         a hierarchical clustering algorithm and the contactMaps similarity.</span>

<span class="sd">        The snapshots are clustered together with the previous found clusters.</span>
<span class="sd">        If and old cluster is found connected to a new one (with the new one</span>
<span class="sd">        being the exemplar) it is ignored and only the new snapshots are</span>
<span class="sd">        counted as members of the cluster. The minimum metric is used as the</span>
<span class="sd">        metric of the cluster&quot;&quot;&quot;</span>
        <span class="n">trajectories</span> <span class="o">=</span> <span class="n">getAllTrajectories</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

        <span class="n">pdb_list</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">contactmaps</span><span class="p">,</span> <span class="n">contacts</span> <span class="o">=</span> <span class="n">processSnapshots</span><span class="p">(</span><span class="n">trajectories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportBaseFilename</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contactThresholdDistance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resname</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span> <span class="o">=</span> <span class="n">clusteringResultsParameters</span><span class="p">(</span><span class="n">pdb_list</span><span class="o">=</span><span class="n">pdb_list</span><span class="p">,</span>
                                     <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="n">contactmaps</span><span class="o">=</span><span class="n">contactmaps</span><span class="p">,</span> <span class="n">contacts</span><span class="o">=</span><span class="n">contacts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span> <span class="o">=</span> <span class="n">clusteringResultsParameters</span><span class="p">(</span><span class="n">contactmaps</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">clusters</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">clusterAgglomerativeContactMaps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">contactmaps</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nclusters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processClusterResults</span><span class="p">(</span><span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">clusterNum</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;old:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">clusterNum</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>

            <span class="n">new_contactmaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="p">)</span>
            <span class="n">clusters</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">clusterAgglomerativeContactMaps</span><span class="p">(</span><span class="n">new_contactmaps</span><span class="p">,</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">nclusters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processClusterResults</span><span class="p">(</span><span class="s">&quot;second&quot;</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">newClusters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">newClusters</span>
</div>
<div class="viewcode-block" id="ContactMapAgglomerativeClustering.processClusterResults"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactMapAgglomerativeClustering.processClusterResults">[docs]</a>    <span class="k">def</span> <span class="nf">processClusterResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Analyse the results obtained from the affinity propagation</span>
<span class="sd">        algorithm.</span>

<span class="sd">        Process [In] String to decide wether it is the results of the first or</span>
<span class="sd">        second clustering</span>
<span class="sd">        clusters [In] Numpy array with the indexes the clusters</span>
<span class="sd">        Labels [In] Numpy array with the cluster each snapshot belongs to&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>
            <span class="n">cluster_members</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">index</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">process</span> <span class="o">==</span> <span class="s">&quot;first&quot;</span><span class="p">:</span>
                <span class="n">elements_in_cluster</span> <span class="o">=</span> <span class="n">cluster_members</span><span class="o">.</span><span class="n">size</span>
                <span class="c"># contactmapsArray = np.array(self.firstClusteringParams.contactmaps)</span>
                <span class="c"># cluster_index = clusterKmeans(contactmapsArray[cluster_members],1)</span>
                <span class="c"># Instead of using Kmeans to obtain a &quot;center&quot; or representative</span>
                <span class="c"># cluster, select one of the members randomly</span>
                <span class="n">metricsArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="n">best_metric_ind</span> <span class="o">=</span> <span class="n">cluster_members</span><span class="p">[</span><span class="n">metricsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">best_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">best_metric_ind</span><span class="p">]</span>

                <span class="n">cluster_center</span> <span class="o">=</span> <span class="n">selectRandomCenter</span><span class="p">(</span><span class="n">cluster_members</span><span class="p">,</span>
                                                    <span class="n">metricsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">])</span>
                <span class="c"># cluster = Cluster(self.firstClusteringParams.pdb_list[best_metric_ind],</span>
                <span class="c">#                   contactMap=self.firstClusteringParams.contactmaps[best_metric_ind], metric=best_metric)</span>

                <span class="n">contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">cluster_center</span><span class="p">]</span>
                <span class="n">numberOfLigandAtoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">pdb_list</span><span class="p">[</span><span class="n">cluster_center</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">()</span>
                <span class="n">contactsPerAtom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">contacts</span><span class="p">)</span><span class="o">/</span><span class="n">numberOfLigandAtoms</span>

                <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">pdb_list</span><span class="p">[</span><span class="n">cluster_center</span><span class="p">],</span>
                                  <span class="n">contactMap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="p">[</span><span class="n">cluster_center</span><span class="p">],</span>
                                  <span class="n">contacts</span><span class="o">=</span><span class="n">contactsPerAtom</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">best_metrics</span><span class="p">,</span> <span class="n">metricCol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

                <span class="n">cluster</span><span class="o">.</span><span class="n">elements</span> <span class="o">+=</span> <span class="n">elements_in_cluster</span><span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;new:</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">contactmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">newClusters</span><span class="o">.</span><span class="n">addCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elementsArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                <span class="n">metricsArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="n">elements_in_cluster</span> <span class="o">=</span> <span class="n">elementsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">best_metric_ind</span> <span class="o">=</span> <span class="n">cluster_members</span><span class="p">[</span><span class="n">metricsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">best_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">best_metric_ind</span><span class="p">]</span>
                <span class="c"># contactmapsArray = np.array(self.firstClusteringParams.contactmaps)</span>
                <span class="c"># cluster_index = clusterKmeans(contactmapsArray[cluster_members],1)</span>
                <span class="c"># Instead of using Kmeans to obtain a &quot;center&quot; or representative</span>
                <span class="c"># cluster, select one of the members randomly</span>
                <span class="n">cluster_center</span> <span class="o">=</span> <span class="n">selectRandomCenter</span><span class="p">(</span><span class="n">cluster_members</span><span class="p">,</span>
                                                    <span class="n">metricsArray</span><span class="p">[</span><span class="n">cluster_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">])</span>
                <span class="n">cluster_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">cluster_center</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">cluster_center</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nclusters</span><span class="p">:</span>
                    <span class="n">cluster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstClusteringParams</span><span class="o">.</span><span class="n">newClusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">]</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">best_metrics</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">elements</span> <span class="o">+=</span> <span class="p">(</span><span class="n">elements_in_cluster</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secondClusteringParams</span><span class="o">.</span><span class="n">newClusters</span><span class="o">.</span><span class="n">addCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ContactMapAccumulativeClustering"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactMapAccumulativeClustering">[docs]</a><span class="k">class</span> <span class="nc">ContactMapAccumulativeClustering</span><span class="p">(</span><span class="n">Clustering</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Cluster together all snapshots that have similar enough contactMaps.</span>
<span class="sd">        This similarity can be calculated with different methods (see similariyEvaluator documentation)</span>

<span class="sd">        thresholdCalculator [In] ThresholdCalculator object that calculate the threshold</span>
<span class="sd">        similarityEvaluator [In] SimilarityEvaluator object that will determine wether two snapshots</span>
<span class="sd">        are similar enough to belong to the same cluster</span>
<span class="sd">        resname [In] String containing the three letter name of the ligan in the pdb</span>
<span class="sd">        reportBaseFilename [In] Name of the file that contains the metrics of the snapshots to cluster</span>
<span class="sd">        columnOfReportFile [In] Column of the report file that contain the metric of interest</span>
<span class="sd">        contactThresholdDistance [In] Distance at wich a ligand atom and a protein</span>
<span class="sd">        atom are considered in contact(default 8)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresholdCalculator</span><span class="p">,</span> <span class="n">similarityEvaluator</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">reportBaseFilename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columnOfReportFile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">contactThresholdDistance</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">Clustering</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="p">,</span>
                            <span class="n">columnOfReportFile</span><span class="p">,</span> <span class="n">contactThresholdDistance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">clusteringTypes</span><span class="o">.</span><span class="n">CLUSTERING_TYPES</span><span class="o">.</span><span class="n">contactMapAccumulative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholdCalculator</span> <span class="o">=</span> <span class="n">thresholdCalculator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">similarityEvaluator</span> <span class="o">=</span> <span class="n">similarityEvaluator</span>

    <span class="c">#TODO: refactor --&gt; move to parent class and only keep here contactMap creation</span>
<div class="viewcode-block" id="ContactMapAccumulativeClustering.addSnapshotToCluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ContactMapAccumulativeClustering.addSnapshotToCluster">[docs]</a>    <span class="k">def</span> <span class="nf">addSnapshotToCluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snapshot</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[],</span> <span class="n">metricCol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">pdb</span> <span class="o">=</span> <span class="n">atomset</span><span class="o">.</span><span class="n">PDB</span><span class="p">()</span>
        <span class="n">pdb</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resname</span><span class="p">)</span>
        <span class="n">contactMap</span><span class="p">,</span> <span class="n">contacts</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">createContactMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contactThresholdDistance</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">clusterNum</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarityEvaluator</span><span class="o">.</span><span class="n">isSimilarCluster</span><span class="p">(</span><span class="n">contactMap</span><span class="p">,</span> <span class="n">cluster</span><span class="p">):</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">addElement</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c"># if made it here, the snapshot was not added into any cluster</span>
        <span class="n">numberOfLigandAtoms</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">()</span>
        <span class="n">contactsPerAtom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">contacts</span><span class="p">)</span><span class="o">/</span><span class="n">numberOfLigandAtoms</span>

        <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholdCalculator</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">contactsPerAtom</span><span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">pdb</span><span class="p">,</span> <span class="n">thresholdRadius</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                          <span class="n">contacts</span><span class="o">=</span><span class="n">contactsPerAtom</span><span class="p">,</span> <span class="n">contactMap</span><span class="o">=</span><span class="n">contactMap</span><span class="p">,</span>
                          <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="n">metricCol</span><span class="o">=</span><span class="n">metricCol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">addCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ClusteringBuilder"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ClusteringBuilder">[docs]</a><span class="k">class</span> <span class="nc">ClusteringBuilder</span><span class="p">:</span>
<div class="viewcode-block" id="ClusteringBuilder.buildClustering"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.ClusteringBuilder.buildClustering">[docs]</a>    <span class="k">def</span> <span class="nf">buildClustering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clusteringBlock</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columnOfReportFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">paramsBlock</span> <span class="o">=</span> <span class="n">clusteringBlock</span><span class="p">[</span><span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">params</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resname</span> <span class="o">=</span> <span class="n">paramsBlock</span><span class="p">[</span><span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">ligandResname</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">clusteringType</span> <span class="o">=</span> <span class="n">clusteringBlock</span><span class="p">[</span><span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
            <span class="n">contactThresholdDistance</span> <span class="o">=</span> <span class="n">paramsBlock</span><span class="p">[</span><span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">contactThresholdDistance</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">err</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;: Need to provide mandatory parameter in clustering block&quot;</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clusteringType</span> <span class="o">==</span> <span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
            <span class="n">symmetries</span> <span class="o">=</span> <span class="n">paramsBlock</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">symmetries</span><span class="p">,{})</span>

            <span class="n">thresholdCalculatorBuilder</span> <span class="o">=</span> <span class="n">thresholdcalculator</span><span class="o">.</span><span class="n">ThresholdCalculatorBuilder</span><span class="p">()</span>
            <span class="n">thresholdCalculator</span> <span class="o">=</span> <span class="n">thresholdCalculatorBuilder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">clusteringBlock</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ContactsClustering</span><span class="p">(</span><span class="n">thresholdCalculator</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span>
                                      <span class="n">reportBaseFilename</span><span class="p">,</span> <span class="n">columnOfReportFile</span><span class="p">,</span>
                                      <span class="n">contactThresholdDistance</span><span class="p">,</span> <span class="n">symmetries</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">clusteringType</span> <span class="o">==</span> <span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">contactMapAffinity</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ContactMapClustering</span><span class="p">(</span><span class="n">resname</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="p">,</span>
                                        <span class="n">columnOfReportFile</span><span class="p">,</span>
                                        <span class="n">contactThresholdDistance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">clusteringType</span> <span class="o">==</span> <span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">contactMapAgglomerative</span><span class="p">:</span>
            <span class="n">nclusters</span> <span class="o">=</span> <span class="n">paramsBlock</span><span class="p">[</span><span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">nclusters</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ContactMapAgglomerativeClustering</span><span class="p">(</span><span class="n">nclusters</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span>
                                                     <span class="n">reportBaseFilename</span><span class="p">,</span>
                                                     <span class="n">columnOfReportFile</span><span class="p">,</span>
                                                     <span class="n">contactThresholdDistance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">clusteringType</span> <span class="o">==</span> <span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">contactMapAccumulative</span><span class="p">:</span>
            <span class="n">thresholdCalculatorBuilder</span> <span class="o">=</span> <span class="n">thresholdcalculator</span><span class="o">.</span><span class="n">ThresholdCalculatorBuilder</span><span class="p">()</span>
            <span class="n">thresholdCalculator</span> <span class="o">=</span> <span class="n">thresholdCalculatorBuilder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">clusteringBlock</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">similarityEvaluatorType</span> <span class="o">=</span> <span class="n">paramsBlock</span><span class="p">[</span><span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">similarityEvaluator</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;No similarity Evaluator specified!!&quot;</span><span class="p">)</span>
            <span class="n">similarityBuilder</span> <span class="o">=</span> <span class="n">similarityEvaluatorBuilder</span><span class="p">()</span>
            <span class="n">similarityEvaluator</span> <span class="o">=</span> <span class="n">similarityBuilder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">similarityEvaluatorType</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ContactMapAccumulativeClustering</span><span class="p">(</span><span class="n">thresholdCalculator</span><span class="p">,</span> <span class="n">similarityEvaluator</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span>
                                      <span class="n">reportBaseFilename</span><span class="p">,</span> <span class="n">columnOfReportFile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&quot;Unknown clustering method! Choices are: &quot;</span> <span class="o">+</span>
                     <span class="nb">str</span><span class="p">(</span><span class="n">clusteringTypes</span><span class="o">.</span><span class="n">CLUSTERING_TYPE_TO_STRING_DICTIONARY</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

</div></div>
<div class="viewcode-block" id="clusteringResultsParameters"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.clusteringResultsParameters">[docs]</a><span class="k">class</span> <span class="nc">clusteringResultsParameters</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper object to pass parameters in the ContactMap affinity and agglomerative clustering</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdb_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[],</span> <span class="n">contactmaps</span><span class="o">=</span><span class="p">[],</span> <span class="n">contacts</span><span class="o">=</span><span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdb_list</span> <span class="o">=</span> <span class="n">pdb_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contactmaps</span> <span class="o">=</span> <span class="n">contactmaps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newClusters</span> <span class="o">=</span> <span class="n">Clusters</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">=</span> <span class="n">contacts</span>

</div>
<div class="viewcode-block" id="similarityEvaluatorBuilder"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.similarityEvaluatorBuilder">[docs]</a><span class="k">class</span> <span class="nc">similarityEvaluatorBuilder</span><span class="p">:</span>
<div class="viewcode-block" id="similarityEvaluatorBuilder.build"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.similarityEvaluatorBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarityEvaluatorType</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">similarityEvaluatorType</span> <span class="o">==</span> <span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">differenceDistance</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">differenceDistanceEvaluator</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">similarityEvaluatorType</span> <span class="o">==</span> <span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">Jaccard</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JaccardEvaluator</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">similarityEvaluatorType</span> <span class="o">==</span> <span class="n">blockNames</span><span class="o">.</span><span class="n">ClusteringTypes</span><span class="o">.</span><span class="n">correlation</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">correlationEvaluator</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&quot;Unknown threshold calculator type! Choices are: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">clusteringTypes</span><span class="o">.</span><span class="n">SIMILARITY_TYPES_TO_STRING_DICTIONARY</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

</div></div>
<div class="viewcode-block" id="differenceDistanceEvaluator"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.differenceDistanceEvaluator">[docs]</a><span class="k">class</span> <span class="nc">differenceDistanceEvaluator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the similarity of two contactMaps by calculating the ratio of</span>
<span class="sd">        the number of differences over the average of elements in the contacts maps</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="differenceDistanceEvaluator.isSimilarCluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.differenceDistanceEvaluator.isSimilarCluster">[docs]</a>    <span class="k">def</span> <span class="nf">isSimilarCluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contactMap</span><span class="p">,</span> <span class="n">cluster</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Evaluate if two contactMaps are similar or not, return True if yes,</span>
<span class="sd">            False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">differenceContactMaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">contactMap</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">averageContacts</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">contactMap</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">averageContacts</span><span class="p">:</span>
            <span class="c"># The only way the denominator can be 0 is if both contactMaps are</span>
            <span class="c"># all zeros, thus being equal and belonging to the same cluster</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">differenceContactMaps</span><span class="o">/</span><span class="n">averageContacts</span>
            <span class="k">return</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">cluster</span><span class="o">.</span><span class="n">threshold</span>


</div></div>
<div class="viewcode-block" id="JaccardEvaluator"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.JaccardEvaluator">[docs]</a><span class="k">class</span> <span class="nc">JaccardEvaluator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the similarity of two contactMaps by calculating the Jaccard</span>
<span class="sd">        index, that is, the ratio between the intersection of the two contact maps and their</span>
<span class="sd">        union</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="JaccardEvaluator.isSimilarCluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.JaccardEvaluator.isSimilarCluster">[docs]</a>    <span class="k">def</span> <span class="nf">isSimilarCluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contactMap</span><span class="p">,</span> <span class="n">cluster</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Evaluate if two contactMaps are similar or not, return True if yes,</span>
<span class="sd">            False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intersectContactMaps</span> <span class="o">=</span> <span class="p">(</span><span class="n">contactMap</span> <span class="o">==</span> <span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">unionContactMaps</span> <span class="o">=</span> <span class="n">contactMap</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">intersectContactMaps</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">intersectContactMaps</span><span class="p">)</span><span class="o">/</span><span class="n">unionContactMaps</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">similarity</span>
        <span class="k">return</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">cluster</span><span class="o">.</span><span class="n">threshold</span>

</div></div>
<div class="viewcode-block" id="correlationEvaluator"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.correlationEvaluator">[docs]</a><span class="k">class</span> <span class="nc">correlationEvaluator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the similarity of two contact maps by calculating thir correlation</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="correlationEvaluator.isSimilarCluster"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.correlationEvaluator.isSimilarCluster">[docs]</a>    <span class="k">def</span> <span class="nf">isSimilarCluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contactMap</span><span class="p">,</span> <span class="n">cluster</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Evaluate if two contactMaps are similar or not, return True if yes,</span>
<span class="sd">            False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="n">calculateCorrelationContactMaps</span><span class="p">(</span><span class="n">contactMap</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">contactMap</span><span class="p">)</span>
        <span class="n">similarity</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c"># Necessary to omit negative correlations</span>
        <span class="n">similarity</span> <span class="o">/=</span> <span class="mf">2.0</span>  <span class="c"># Correlation values need to be higher now</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">similarity</span>
        <span class="k">return</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">cluster</span><span class="o">.</span><span class="n">threshold</span>


<span class="c"># TODO: should it be a class method?</span></div></div>
<div class="viewcode-block" id="clusterContactMaps"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.clusterContactMaps">[docs]</a><span class="k">def</span> <span class="nf">clusterContactMaps</span><span class="p">(</span><span class="n">contactmaps</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cluster multiple contact maps with the affinity propagation algorithm</span>
<span class="sd">        contactmaps [In] Array of contact maps</span>
<span class="sd">        preferences [In] Input value to the affinity propagation algorithm, it</span>
<span class="sd">        affects the number of clusters that will be generated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contactmaps</span> <span class="o">=</span> <span class="n">contactmaps</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">contactmaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">affinitypropagation</span> <span class="o">=</span> <span class="n">AffinityPropagation</span><span class="p">(</span><span class="n">damping</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                              <span class="n">preference</span><span class="o">=</span><span class="n">preferences</span><span class="p">,</span>
                                              <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">contactmaps</span><span class="p">)</span>
    <span class="n">cluster_center_indices</span> <span class="o">=</span> <span class="n">affinitypropagation</span><span class="o">.</span><span class="n">cluster_centers_indices_</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">affinitypropagation</span><span class="o">.</span><span class="n">labels_</span>
    <span class="k">return</span> <span class="n">cluster_center_indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="clusterAgglomerativeContactMaps"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.clusterAgglomerativeContactMaps">[docs]</a><span class="k">def</span> <span class="nf">clusterAgglomerativeContactMaps</span><span class="p">(</span><span class="n">contactmaps</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cluster multiple contact maps with the hierarchical clustering algorithm</span>
<span class="sd">        contactmaps [In] Array of contact maps</span>
<span class="sd">        n_clusters [In] Number of clusters that the clustering should generate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contactmaps</span> <span class="o">=</span> <span class="n">contactmaps</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">contactmaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">agglomerative</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span>
                                            <span class="n">linkage</span><span class="o">=</span><span class="s">&#39;complete&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">contactmaps</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">agglomerative</span><span class="o">.</span><span class="n">labels_</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">labels</span>

</div>
<div class="viewcode-block" id="clusterKmeans"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.clusterKmeans">[docs]</a><span class="k">def</span> <span class="nf">clusterKmeans</span><span class="p">(</span><span class="n">contactmaps</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cluster  multiple contact maps with the kmeans clustering algorithm</span>
<span class="sd">        contactmaps [In] Array of contact maps</span>
<span class="sd">        n_clusters [In] Number of clusters that the clustering should generate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contactmaps</span> <span class="o">=</span> <span class="n">contactmaps</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">contactmaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">contactmaps</span><span class="p">)</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">contactmaps</span> <span class="o">-=</span> <span class="n">center</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">contactmaps</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cluster_center</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cluster_center</span>

</div>
<div class="viewcode-block" id="getAllTrajectories"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.getAllTrajectories">[docs]</a><span class="k">def</span> <span class="nf">getAllTrajectories</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all the trajectory files in the paths specified</span>

<span class="sd">        :param paths: The path where to find the trajectories</span>
<span class="sd">        :type paths: str</span>
<span class="sd">        :returns: list -- A list with the names of all th trajectories in paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">+=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">files</span>

</div>
<div class="viewcode-block" id="selectRandomCenter"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.selectRandomCenter">[docs]</a><span class="k">def</span> <span class="nf">selectRandomCenter</span><span class="p">(</span><span class="n">cluster_members</span><span class="p">,</span> <span class="n">metrics_weights</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract a center randomly from a cluster, weighted according to their</span>
<span class="sd">        metrics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metrics_weights</span> <span class="o">-=</span> <span class="n">metrics_weights</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">metrics_weights</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
        <span class="n">metrics_weights</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">T</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="n">kbT</span> <span class="o">=</span> <span class="mf">0.001987</span><span class="o">*</span><span class="n">T</span>
        <span class="n">metrics_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">metrics_weights</span><span class="o">/</span><span class="n">kbT</span><span class="p">)</span>
        <span class="n">metrics_weights</span> <span class="o">/=</span> <span class="n">metrics_weights</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">cluster_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">cluster_members</span><span class="p">,</span>
                                     <span class="n">p</span><span class="o">=</span><span class="n">metrics_weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cluster_index</span>

</div>
<div class="viewcode-block" id="calculateCorrelationContactMaps"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.calculateCorrelationContactMaps">[docs]</a><span class="k">def</span> <span class="nf">calculateCorrelationContactMaps</span><span class="p">(</span><span class="n">contactMap</span><span class="p">,</span> <span class="n">clusterContactMap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the correlation of two contactMaps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contactMap1</span> <span class="o">=</span> <span class="n">contactMap</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="c"># Reshape the matrix into a 1D array to use the numpy corrcoef function</span>
    <span class="n">contactMap2</span> <span class="o">=</span> <span class="n">clusterContactMap</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">contactMap1</span><span class="p">,</span> <span class="n">contactMap2</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="processSnapshots"><a class="viewcode-back" href="../../../src.clustering.html#src.clustering.clustering.processSnapshots">[docs]</a><span class="k">def</span> <span class="nf">processSnapshots</span><span class="p">(</span><span class="n">trajectories</span><span class="p">,</span> <span class="n">reportBaseFilename</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span>
                     <span class="n">contactThresholdDistance</span><span class="p">,</span> <span class="n">resname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create list of pdb, contactMaps, metrics and contacts from a series of</span>
<span class="sd">        snapshots</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pdb_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">contactmaps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">contacts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">trajectory</span> <span class="ow">in</span> <span class="n">trajectories</span><span class="p">:</span>
        <span class="n">trajNum</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">getTrajNum</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="n">snapshots</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">getSnapshots</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reportBaseFilename</span><span class="p">:</span>
            <span class="n">reportFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">reportBaseFilename</span> <span class="o">%</span> <span class="n">trajNum</span><span class="p">)</span>
            <span class="n">metricstraj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">reportFilename</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metricstraj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snapshots</span><span class="p">))</span>
        <span class="c"># Prepare data for clustering</span>
        <span class="n">metrics</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">metricstraj</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snapshots</span><span class="p">):</span>
            <span class="n">pdb</span> <span class="o">=</span> <span class="n">atomset</span><span class="o">.</span><span class="n">PDB</span><span class="p">()</span>
            <span class="n">pdb</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="n">resname</span><span class="p">)</span>
            <span class="n">pdb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdb</span><span class="p">)</span>
            <span class="n">contactMap</span><span class="p">,</span> <span class="n">contactnum</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">createContactMap</span><span class="p">(</span><span class="n">resname</span><span class="p">,</span> <span class="n">contactThresholdDistance</span><span class="p">)</span>
            <span class="n">contactmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contactMap</span><span class="p">)</span>
            <span class="n">contacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contactnum</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pdb_list</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">contactmaps</span><span class="p">,</span> <span class="n">contacts</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Daniel Lecina, Joan Francesc Gilabert.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>